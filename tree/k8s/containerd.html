<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>containerd | Tiantien的个人主页</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/images/icon.jpg">
    <meta name="description" content="工作 生活 成长">
    
    <link rel="preload" href="/assets/css/0.styles.2ed08540.css" as="style"><link rel="preload" href="/assets/js/app.bcfbac2f.js" as="script"><link rel="preload" href="/assets/js/2.883ec247.js" as="script"><link rel="preload" href="/assets/js/31.c2809115.js" as="script"><link rel="preload" href="/assets/js/3.314a3542.js" as="script"><link rel="prefetch" href="/assets/js/10.6e365f99.js"><link rel="prefetch" href="/assets/js/11.eb0a9c06.js"><link rel="prefetch" href="/assets/js/12.7ccff92d.js"><link rel="prefetch" href="/assets/js/13.1a676209.js"><link rel="prefetch" href="/assets/js/14.84569625.js"><link rel="prefetch" href="/assets/js/15.64620e76.js"><link rel="prefetch" href="/assets/js/16.dcd106a3.js"><link rel="prefetch" href="/assets/js/17.4487984b.js"><link rel="prefetch" href="/assets/js/18.df3b341b.js"><link rel="prefetch" href="/assets/js/19.bb69705a.js"><link rel="prefetch" href="/assets/js/20.a0db47c5.js"><link rel="prefetch" href="/assets/js/21.13f70884.js"><link rel="prefetch" href="/assets/js/22.5c3133e9.js"><link rel="prefetch" href="/assets/js/23.01458c00.js"><link rel="prefetch" href="/assets/js/24.d4a9db68.js"><link rel="prefetch" href="/assets/js/25.998e0adb.js"><link rel="prefetch" href="/assets/js/26.25418bff.js"><link rel="prefetch" href="/assets/js/27.8ff41d05.js"><link rel="prefetch" href="/assets/js/28.cdff56fe.js"><link rel="prefetch" href="/assets/js/29.d1db752c.js"><link rel="prefetch" href="/assets/js/30.c677a34a.js"><link rel="prefetch" href="/assets/js/32.dc7e67b3.js"><link rel="prefetch" href="/assets/js/33.cd1f8225.js"><link rel="prefetch" href="/assets/js/34.2151e4cd.js"><link rel="prefetch" href="/assets/js/35.745f43c6.js"><link rel="prefetch" href="/assets/js/36.9bf3793c.js"><link rel="prefetch" href="/assets/js/37.63810e6d.js"><link rel="prefetch" href="/assets/js/38.c5744899.js"><link rel="prefetch" href="/assets/js/39.3da71ecf.js"><link rel="prefetch" href="/assets/js/4.f16064d6.js"><link rel="prefetch" href="/assets/js/40.46937a01.js"><link rel="prefetch" href="/assets/js/41.ffd7badc.js"><link rel="prefetch" href="/assets/js/42.393b38f0.js"><link rel="prefetch" href="/assets/js/43.b13514ee.js"><link rel="prefetch" href="/assets/js/44.5cf1c803.js"><link rel="prefetch" href="/assets/js/5.952f3482.js"><link rel="prefetch" href="/assets/js/6.2901a65d.js"><link rel="prefetch" href="/assets/js/7.dee35a8b.js"><link rel="prefetch" href="/assets/js/8.c81aeacd.js"><link rel="prefetch" href="/assets/js/9.64f79a1d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2ed08540.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/icon.jpg" alt="Tiantien的个人主页" class="logo"> <span class="site-name can-hide">Tiantien的个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/todo/" class="nav-link">
  TodoList
</a></div><div class="nav-item"><a href="/tree/vuepress/" class="nav-link">
  VuePress
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  导读
</a></div><div class="nav-item"><a href="/todo/" class="nav-link">
  TodoList
</a></div><div class="nav-item"><a href="/tree/vuepress/" class="nav-link">
  VuePress
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/tree/k8s/k8s.html" class="sidebar-link">k8s概述</a></li><li><a href="/tree/k8s/configmap.html" class="sidebar-link">ConfigMap</a></li><li><a href="/tree/k8s/containerd.html" aria-current="page" class="active sidebar-link">Containerd</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tree/k8s/containerd.html#containerd-的前世今生" class="sidebar-link">Containerd 的前世今生</a></li><li class="sidebar-sub-header"><a href="/tree/k8s/containerd.html#containerd常用命令" class="sidebar-link">Containerd常用命令</a></li><li class="sidebar-sub-header"><a href="/tree/k8s/containerd.html#如何从harbor私有仓库pull镜像" class="sidebar-link">如何从harbor私有仓库pull镜像</a></li></ul></li><li><a href="/tree/k8s/deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/tree/k8s/ingress.html" class="sidebar-link">Ingress</a></li><li><a href="/tree/k8s/namespace.html" class="sidebar-link">Namespace</a></li><li><a href="/tree/k8s/pod.html" class="sidebar-link">Pod</a></li><li><a href="/tree/k8s/secret.html" class="sidebar-link">Secret</a></li><li><a href="/tree/k8s/service.html" class="sidebar-link">Service</a></li><li><a href="/tree/k8s/statefulset.html" class="sidebar-link">Statefulset</a></li><li><a href="/tree/k8s/持续化存储.html" class="sidebar-link">持续化存储</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="containerd"><a href="#containerd" class="header-anchor">#</a> containerd</h1> <blockquote><p>containerd 实现了 kubernetes 的 Container Runtime Interface (CRI) 接口，提供容器运行时核心功能，如镜像管理、容器管理等，相比 dockerd 更加简单、健壮和可移植。</p></blockquote> <p><a href="https://icloudnative.io/posts/getting-started-with-containerd/" target="_blank" rel="noopener noreferrer">参考地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="containerd-的前世今生"><a href="#containerd-的前世今生" class="header-anchor">#</a> Containerd 的前世今生</h2> <p>很久以前，Docker 强势崛起，以“镜像”这个大招席卷全球，对其他容器技术进行致命的降维打击，使其毫无招架之力，就连 Google 也不例外。Google 为了不被拍死在沙滩上，被迫拉下脸面（当然，跪舔是不可能的），希望 Docker 公司和自己联合推进一个开源的容器运行时作为 Docker 的核心依赖，不然就走着瞧。Docker 公司觉得自己的智商被侮辱了，走着瞧就走着瞧，谁怕谁啊！</p> <p>很明显，Docker 公司的这个决策断送了自己的大好前程，造成了今天的悲剧。</p> <p>紧接着，Google 联合 Red Hat、IBM 等几位巨佬连哄带骗忽悠 Docker 公司将 <code>libcontainer</code> 捐给中立的社区（OCI，Open Container Intiative），并改名为 <code>runc</code>，不留一点 Docker 公司的痕迹~~</p> <p>这还不够，为了彻底扭转 Docker 一家独大的局面，几位大佬又合伙成立了一个基金会叫 <code>CNCF</code>（Cloud Native Computing Fundation），这个名字想必大家都很熟了，我就不详细介绍了。CNCF 的目标很明确，既然在当前的维度上干不过 Docker，干脆往上爬，升级到大规模容器编排的维度，以此来击败 Docker。</p> <p>Docker 公司当然不甘示弱，搬出了 Swarm 和 Kubernetes 进行 PK，最后的结局大家都知道了，Swarm 战败。然后 Docker 公司耍了个小聪明，将自己的核心依赖 <code>Containerd</code> 捐给了 CNCF，以此来标榜 Docker 是一个 PaaS 平台。</p> <p>很明显，这个小聪明又大大加速了自己的灭亡。</p> <p>巨佬们心想，想当初想和你合作搞个中立的核心运行时，你死要面子活受罪，就是不同意，好家伙，现在自己搞了一个，还捐出来了，这是什么操作？也罢，这倒省事了，我就直接拿 <code>Containerd</code> 来做文章吧。</p> <p>首先呢，为了表示 Kubernetes 的中立性，当然要搞个标准化的容器运行时接口，只要适配了这个接口的容器运行时，都可以和我一起玩耍哦，第一个支持这个接口的当然就是 <code>Containerd</code> 啦。至于这个接口的名字，大家应该都知道了，它叫 CRI（Container Runntime Interface）。</p> <p>这样还不行，为了蛊惑 Docker 公司，Kubernetes 暂时先委屈自己，专门在自己的组件中集成了一个 <code>shim</code>（你可以理解为垫片），用来将 CRI 的调用翻译成 Docker 的 API，让 Docker 也能和自己愉快地玩耍，温水煮青蛙，养肥了再杀。。。</p> <p>就这样，Kubernetes 一边假装和 Docker 愉快玩耍，一边背地里不断优化 Containerd 的健壮性以及和 CRI 对接的丝滑性。现在 Containerd 的翅膀已经完全硬了，是时候卸下我的伪装，和 Docker say bye bye 了。后面的事情大家也都知道了~~</p> <p>Docker 这门技术成功了，Docker 这个公司却失败了。</p> <h2 id="containerd常用命令"><a href="#containerd常用命令" class="header-anchor">#</a> Containerd常用命令</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 查看版本</span>
ctr version

Client:
  Version:  v1.4.3
  Revision: 269548fa27e0089a8b8278fc4fc781d7f65a939b
  Go version: go1.15.5

Server:
  Version:  v1.4.3
  Revision: 269548fa27e0089a8b8278fc4fc781d7f65a939b
  UUID: 2a6548bd-6a88-4d26-80e9-ae1763047269
  
<span class="token comment">## 查看插件  </span>
ctr plugin <span class="token function">ls</span>

<span class="token comment">## ctr使用</span>

<span class="token comment">### 镜像下载</span>
ctr i pull docker.io/library/nginx:alpine
<span class="token comment">### 本地镜像列表查询</span>
ctr i <span class="token function">ls</span>

<span class="token comment">### 创建容器</span>
ctr c create docker.io/library/nginx:alpine nginx
<span class="token comment">### 本地容器列表</span>
ctr c <span class="token function">ls</span>

<span class="token comment">### 命名空间</span>
ctr ns <span class="token function">ls</span>
ctr -n k8s.io i <span class="token function">ls</span>
ctr -n k8s.io c <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="如何从harbor私有仓库pull镜像"><a href="#如何从harbor私有仓库pull镜像" class="header-anchor">#</a> 如何从harbor私有仓库pull镜像</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 生成默认配置文件</span>
containerd config default<span class="token operator">&gt;</span> /etc/containerd/config.toml 

<span class="token function">vim</span> /etc/containerd/config.toml 
<span class="token comment">## 添加如下内容</span>
<span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry<span class="token punctuation">]</span>
      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors<span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;docker.io&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://registry-1.docker.io&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.mirrors.<span class="token string">&quot;192.168.30.142&quot;</span><span class="token punctuation">]</span>
          endpoint <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;https://192.168.30.142&quot;</span><span class="token punctuation">]</span>
      <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs<span class="token punctuation">]</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs.<span class="token string">&quot;192.168.30.142&quot;</span>.tls<span class="token punctuation">]</span>
           insecure_skip_verify <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token punctuation">[</span>plugins.<span class="token string">&quot;io.containerd.grpc.v1.cri&quot;</span>.registry.configs.<span class="token string">&quot;192.168.30.142&quot;</span>.auth<span class="token punctuation">]</span>
           username <span class="token operator">=</span> <span class="token string">&quot;admin&quot;</span>
           password <span class="token operator">=</span> <span class="token string">&quot;Harbor12345&quot;</span>
<span class="token comment">## 重启服务</span>
systemctl restart containerd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/18/2022, 12:34:13 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/tree/k8s/configmap.html" class="prev">
        ConfigMap
      </a></span> <span class="next"><a href="/tree/k8s/deployment.html">
        Deployment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/assets/js/app.bcfbac2f.js" defer></script><script src="/assets/js/2.883ec247.js" defer></script><script src="/assets/js/31.c2809115.js" defer></script><script src="/assets/js/3.314a3542.js" defer></script>
  </body>
</html>
