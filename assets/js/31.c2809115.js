(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{311:function(s,n,t){"use strict";t.r(n);var a=t(5),r=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"containerd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#containerd"}},[s._v("#")]),s._v(" containerd")]),s._v(" "),n("blockquote",[n("p",[s._v("containerd 实现了 kubernetes 的 Container Runtime Interface (CRI) 接口，提供容器运行时核心功能，如镜像管理、容器管理等，相比 dockerd 更加简单、健壮和可移植。")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://icloudnative.io/posts/getting-started-with-containerd/",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考地址"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"containerd-的前世今生"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#containerd-的前世今生"}},[s._v("#")]),s._v(" Containerd 的前世今生")]),s._v(" "),n("p",[s._v("很久以前，Docker 强势崛起，以“镜像”这个大招席卷全球，对其他容器技术进行致命的降维打击，使其毫无招架之力，就连 Google 也不例外。Google 为了不被拍死在沙滩上，被迫拉下脸面（当然，跪舔是不可能的），希望 Docker 公司和自己联合推进一个开源的容器运行时作为 Docker 的核心依赖，不然就走着瞧。Docker 公司觉得自己的智商被侮辱了，走着瞧就走着瞧，谁怕谁啊！")]),s._v(" "),n("p",[s._v("很明显，Docker 公司的这个决策断送了自己的大好前程，造成了今天的悲剧。")]),s._v(" "),n("p",[s._v("紧接着，Google 联合 Red Hat、IBM 等几位巨佬连哄带骗忽悠 Docker 公司将 "),n("code",[s._v("libcontainer")]),s._v(" 捐给中立的社区（OCI，Open Container Intiative），并改名为 "),n("code",[s._v("runc")]),s._v("，不留一点 Docker 公司的痕迹~~")]),s._v(" "),n("p",[s._v("这还不够，为了彻底扭转 Docker 一家独大的局面，几位大佬又合伙成立了一个基金会叫 "),n("code",[s._v("CNCF")]),s._v("（Cloud Native Computing Fundation），这个名字想必大家都很熟了，我就不详细介绍了。CNCF 的目标很明确，既然在当前的维度上干不过 Docker，干脆往上爬，升级到大规模容器编排的维度，以此来击败 Docker。")]),s._v(" "),n("p",[s._v("Docker 公司当然不甘示弱，搬出了 Swarm 和 Kubernetes 进行 PK，最后的结局大家都知道了，Swarm 战败。然后 Docker 公司耍了个小聪明，将自己的核心依赖 "),n("code",[s._v("Containerd")]),s._v(" 捐给了 CNCF，以此来标榜 Docker 是一个 PaaS 平台。")]),s._v(" "),n("p",[s._v("很明显，这个小聪明又大大加速了自己的灭亡。")]),s._v(" "),n("p",[s._v("巨佬们心想，想当初想和你合作搞个中立的核心运行时，你死要面子活受罪，就是不同意，好家伙，现在自己搞了一个，还捐出来了，这是什么操作？也罢，这倒省事了，我就直接拿 "),n("code",[s._v("Containerd")]),s._v(" 来做文章吧。")]),s._v(" "),n("p",[s._v("首先呢，为了表示 Kubernetes 的中立性，当然要搞个标准化的容器运行时接口，只要适配了这个接口的容器运行时，都可以和我一起玩耍哦，第一个支持这个接口的当然就是 "),n("code",[s._v("Containerd")]),s._v(" 啦。至于这个接口的名字，大家应该都知道了，它叫 CRI（Container Runntime Interface）。")]),s._v(" "),n("p",[s._v("这样还不行，为了蛊惑 Docker 公司，Kubernetes 暂时先委屈自己，专门在自己的组件中集成了一个 "),n("code",[s._v("shim")]),s._v("（你可以理解为垫片），用来将 CRI 的调用翻译成 Docker 的 API，让 Docker 也能和自己愉快地玩耍，温水煮青蛙，养肥了再杀。。。")]),s._v(" "),n("p",[s._v("就这样，Kubernetes 一边假装和 Docker 愉快玩耍，一边背地里不断优化 Containerd 的健壮性以及和 CRI 对接的丝滑性。现在 Containerd 的翅膀已经完全硬了，是时候卸下我的伪装，和 Docker say bye bye 了。后面的事情大家也都知道了~~")]),s._v(" "),n("p",[s._v("Docker 这门技术成功了，Docker 这个公司却失败了。")]),s._v(" "),n("h2",{attrs:{id:"containerd常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#containerd常用命令"}},[s._v("#")]),s._v(" Containerd常用命令")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看版本")]),s._v("\nctr version\n\nClient:\n  Version:  v1.4.3\n  Revision: 269548fa27e0089a8b8278fc4fc781d7f65a939b\n  Go version: go1.15.5\n\nServer:\n  Version:  v1.4.3\n  Revision: 269548fa27e0089a8b8278fc4fc781d7f65a939b\n  UUID: 2a6548bd-6a88-4d26-80e9-ae1763047269\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看插件  ")]),s._v("\nctr plugin "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ctr使用")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 镜像下载")]),s._v("\nctr i pull docker.io/library/nginx:alpine\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 本地镜像列表查询")]),s._v("\nctr i "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 创建容器")]),s._v("\nctr c create docker.io/library/nginx:alpine nginx\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 本地容器列表")]),s._v("\nctr c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 命名空间")]),s._v("\nctr ns "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nctr -n k8s.io i "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nctr -n k8s.io c "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br")])]),n("h2",{attrs:{id:"如何从harbor私有仓库pull镜像"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何从harbor私有仓库pull镜像"}},[s._v("#")]),s._v(" 如何从harbor私有仓库pull镜像")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 生成默认配置文件")]),s._v("\ncontainerd config default"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/containerd/config.toml \n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/containerd/config.toml \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 添加如下内容")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.mirrors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.mirrors."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          endpoint "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry-1.docker.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.mirrors."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.30.142"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n          endpoint "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://192.168.30.142"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.configs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.configs."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.30.142"')]),s._v(".tls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n           insecure_skip_verify "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.configs."),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.30.142"')]),s._v(".auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n           username "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n           password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Harbor12345"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 重启服务")]),s._v("\nsystemctl restart containerd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])])])}),[],!1,null,null,null);n.default=r.exports}}]);